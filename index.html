<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wavewin - Color Prediction Game</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .game-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .red-gradient {
            background: linear-gradient(135deg, #e60000, #ff3333);
        }
        .green-gradient {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .violet-gradient {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        .blue-gradient {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        .orange-gradient {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .spin-animation {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .number-button {
            transition: all 0.3s ease;
        }
        .number-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .result-ball {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
            margin: 0 5px;
        }
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1f2937;
            z-index: 1000;
        }
        .balance-card {
            background: linear-gradient(135deg, #1f2937, #374151);
            border: 2px solid #e60000;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
        }
        .betting-disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(31, 41, 55, 0.9);
            backdrop-filter: blur(10px);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .online-indicator {
            position: relative;
        }
        .online-indicator::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            border: 2px solid #1f2937;
        }
        .bet-option {
            transition: all 0.3s ease;
            transform: scale(1);
        }
        .bet-option:hover {
            transform: scale(1.02);
        }
        .bet-option.selected {
            transform: scale(1.05);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5);
        }
        .countdown-circle {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(#e60000 0deg, #e60000 var(--progress, 0deg), #374151 var(--progress, 0deg));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        .countdown-inner {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #1f2937;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
        }
        .realtime-badge {
            position: fixed;
            top: 70px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 50;
        }
        .winning-animation {
            animation: winPulse 1s ease-in-out infinite;
        }
        @keyframes winPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .losing-animation {
            animation: losePulse 1s ease-in-out;
        }
        @keyframes losePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(0.9); }
        }
        .error-message {
            color: #ef4444;
            font-size: 14px;
            margin-top: 5px;
        }
        .success-message {
            color: #10b981;
            font-size: 14px;
            margin-top: 5px;
        }
        .data-sync-indicator {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #3b82f6;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .data-sync-indicator.show {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Data Sync Indicator -->
    <div id="dataSyncIndicator" class="data-sync-indicator">
        <i class="fas fa-sync-alt spin-animation mr-2"></i>
        Syncing data...
    </div>

    <!-- Real-time Status Badge -->
    <div class="realtime-badge">
        <i class="fas fa-wifi mr-1"></i>
        <span id="realtimeStatus">Online</span>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification hidden">
        <div id="notificationContent" class="bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg">
            <i class="fas fa-check-circle mr-2"></i>
            <span id="notificationText">Success!</span>
        </div>
    </div>

    <!-- Login/Signup Screen -->
    <div id="authScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl border-2 border-red-600 max-w-md w-full">
            <div class="text-center mb-8">
                <i class="fas fa-water text-6xl text-red-500 mb-4"></i>
                <h1 class="text-3xl font-bold bg-gradient-to-r from-red-500 to-red-600 bg-clip-text text-transparent">WAVEWIN</h1>
                <p class="text-gray-400">Color Prediction Game</p>
                <div class="mt-4 flex items-center justify-center space-x-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full online-indicator"></div>
                    <span class="text-sm text-green-400">Online Players: <span id="onlineCount">0</span></span>
                </div>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number</label>
                    <input type="text" id="loginPhone" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none text-white" placeholder="Enter your phone number" maxlength="10">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none text-white" placeholder="Enter your password">
                </div>
                
                <div id="loginError" class="text-red-400 text-sm hidden">
                    <i class="fas fa-exclamation-circle mr-2"></i>
                    <span></span>
                </div>
                
                <button id="loginBtn" class="w-full red-gradient text-white py-3 rounded-lg font-semibold">
                    <i class="fas fa-sign-in-alt mr-2"></i>
                    Login
                </button>
                
                <div class="text-center">
                    <span class="text-gray-400">Don't have an account? </span>
                    <button id="showSignup" class="text-red-500 hover:text-red-400">Sign Up</button>
                    <button id="showForgotPassword" class="text-blue-500 hover:text-blue-400 block mt-2">Forgot Password?</button>
                </div>
            </div>
            
            <!-- Signup Form -->
            <div id="signupForm" class="space-y-6 hidden">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Full Name</label>
                    <input type="text" id="signupName" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none text-white" placeholder="Enter your full name">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number</label>
                    <input type="text" id="signupPhone" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none text-white" placeholder="Enter your phone number" maxlength="10">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                    <input type="password" id="signupPassword" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none text-white" placeholder="Create a password">
                </div>
                
                <div id="signupError" class="text-red-400 text-sm hidden">
                    <i class="fas fa-exclamation-circle mr-2"></i>
                    <span></span>
                </div>
                
                <button id="signupBtn" class="w-full green-gradient text-white py-3 rounded-lg font-semibold">
                    <i class="fas fa-user-plus mr-2"></i>
                    Sign Up & Get ₹100 Bonus
                </button>
                
                <div class="text-center">
                    <span class="text-gray-400">Already have an account? </span>
                    <button id="showLogin" class="text-red-500 hover:text-red-400">Login</button>
                </div>
            </div>

            <!-- Forgot Password Form -->
            <div id="forgotPasswordForm" class="space-y-6 hidden">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number</label>
                    <input type="text" id="forgotPhone" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none text-white" placeholder="Enter your phone number" maxlength="10">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">New Password</label>
                    <input type="password" id="newPassword" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none text-white" placeholder="Enter new password">
                </div>
                
                <div id="forgotError" class="text-red-400 text-sm hidden">
                    <i class="fas fa-exclamation-circle mr-2"></i>
                    <span></span>
                </div>
                
                <button id="resetPasswordBtn" class="w-full green-gradient text-white py-3 rounded-lg font-semibold">
                    <i class="fas fa-key mr-2"></i>
                    Reset Password
                </button>
                
                <div class="text-center">
                    <button id="showLoginFromForgot" class="text-red-500 hover:text-red-400">Back to Login</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Game Screen -->
    <div id="gameScreen" class="hidden min-h-screen">
        <!-- Header -->
        <div class="bg-gray-800 p-4 shadow-lg">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-water text-2xl text-red-500"></i>
                    <h1 class="text-xl font-bold bg-gradient-to-r from-red-500 to-red-600 bg-clip-text text-transparent">WAVEWIN</h1>
                    <div class="text-xs text-green-400">
                        <i class="fas fa-circle mr-1"></i>
                        <span id="activeUsers">0</span> online
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="balance-card px-4 py-2 rounded-lg">
                        <div class="text-xs text-gray-400">Balance</div>
                        <div class="text-lg font-bold text-white">₹<span id="userBalance">0.00</span></div>
                    </div>
                    <button id="profileBtn" class="text-gray-300 hover:text-white">
                        <i class="fas fa-user-circle text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Game Tab Content -->
        <div id="gameTabContent" class="tab-content active">
            <div class="container mx-auto px-4 py-6 pb-20">
                <!-- Current Period & Timer -->
                <div class="bg-gray-800 rounded-xl p-6 mb-6 text-center">
                    <div class="text-gray-400 text-sm mb-2">Current Period</div>
                    <div class="text-2xl font-bold text-white mb-4" id="currentPeriod">Loading...</div>
                    
                    <div class="countdown-circle mb-4">
                        <div class="countdown-inner">
                            <span id="countdown">30</span>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <div id="bettingStatus" class="text-green-400 text-sm">
                            <i class="fas fa-circle text-green-400 mr-2"></i>Betting Open
                        </div>
                        <div class="text-xs text-gray-400 mt-1">
                            Active Bets: <span id="activeBetsCount">0</span>
                        </div>
                    </div>
                </div>

                <!-- Betting Section -->
                <div id="bettingSection" class="bg-gray-800 rounded-xl p-6 mb-6">
                    <h3 class="text-lg font-semibold text-white mb-4">
                        <i class="fas fa-palette mr-2"></i>Select Color
                    </h3>
                    
                    <!-- Color Buttons -->
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <button class="bet-option bet-color-btn red-gradient p-4 rounded-xl text-white font-semibold text-lg" data-color="red" data-multiplier="1.96">
                            <div>Red</div>
                            <div class="text-sm opacity-80">1:1.96</div>
                        </button>
                        <button class="bet-option bet-color-btn violet-gradient p-4 rounded-xl text-white font-semibold text-lg" data-color="violet" data-multiplier="2.9">
                            <div>Violet</div>
                            <div class="text-sm opacity-80">1:2.9</div>
                        </button>
                        <button class="bet-option bet-color-btn green-gradient p-4 rounded-xl text-white font-semibold text-lg" data-color="green" data-multiplier="1.96">
                            <div>Green</div>
                            <div class="text-sm opacity-80">1:1.96</div>
                        </button>
                    </div>

                    <!-- Number Buttons -->
                    <h3 class="text-lg font-semibold text-white mb-4">
                        <i class="fas fa-hashtag mr-2"></i>Select Number
                    </h3>
                    <div class="grid grid-cols-5 gap-3 mb-6">
                        <button class="bet-option bet-number-btn number-button bg-violet-600 hover:bg-violet-700 p-3 rounded-lg text-white font-semibold" data-number="0" data-multiplier="8.9">0</button>
                        <button class="bet-option bet-number-btn number-button bg-green-600 hover:bg-green-700 p-3 rounded-lg text-white font-semibold" data-number="1" data-multiplier="8.9">1</button>
                        <button class="bet-option bet-number-btn number-button bg-red-600 hover:bg-red-700 p-3 rounded-lg text-white font-semibold" data-number="2" data-multiplier="8.9">2</button>
                        <button class="bet-option bet-number-btn number-button bg-green-600 hover:bg-green-700 p-3 rounded-lg text-white font-semibold" data-number="3" data-multiplier="8.9">3</button>
                        <button class="bet-option bet-number-btn number-button bg-red-600 hover:bg-red-700 p-3 rounded-lg text-white font-semibold" data-number="4" data-multiplier="8.9">4</button>
                        <button class="bet-option bet-number-btn number-button bg-violet-600 hover:bg-violet-700 p-3 rounded-lg text-white font-semibold" data-number="5" data-multiplier="8.9">5</button>
                        <button class="bet-option bet-number-btn number-button bg-red-600 hover:bg-red-700 p-3 rounded-lg text-white font-semibold" data-number="6" data-multiplier="8.9">6</button>
                        <button class="bet-option bet-number-btn number-button bg-green-600 hover:bg-green-700 p-3 rounded-lg text-white font-semibold" data-number="7" data-multiplier="8.9">7</button>
                        <button class="bet-option bet-number-btn number-button bg-red-600 hover:bg-red-700 p-3 rounded-lg text-white font-semibold" data-number="8" data-multiplier="8.9">8</button>
                        <button class="bet-option bet-number-btn number-button bg-green-600 hover:bg-green-700 p-3 rounded-lg text-white font-semibold" data-number="9" data-multiplier="8.9">9</button>
                    </div>

                    <!-- Big/Small Section -->
                    <h3 class="text-lg font-semibold text-white mb-4">
                        <i class="fas fa-expand-arrows-alt mr-2"></i>Big or Small
                    </h3>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <button class="bet-option bet-size-btn blue-gradient p-4 rounded-xl text-white font-semibold text-lg" data-size="small" data-multiplier="1.9">
                            <div>Small</div>
                            <div class="text-sm opacity-80">0,1,2,3,4</div>
                            <div class="text-sm opacity-80">1:1.9</div>
                        </button>
                        <button class="bet-option bet-size-btn orange-gradient p-4 rounded-xl text-white font-semibold text-lg" data-size="big" data-multiplier="1.9">
                            <div>Big</div>
                            <div class="text-sm opacity-80">5,6,7,8,9</div>
                            <div class="text-sm opacity-80">1:1.9</div>
                        </button>
                    </div>

                    <!-- Bet Amount -->
                    <div class="mb-4">
                        <h3 class="text-lg font-semibold text-white mb-3">
                            <i class="fas fa-rupee-sign mr-2"></i>Bet Amount
                        </h3>
                        <div class="grid grid-cols-4 gap-3 mb-4">
                            <button class="bet-amount-btn bg-gray-700 hover:bg-gray-600 p-3 rounded-lg text-white font-semibold" data-amount="10">₹10</button>
                            <button class="bet-amount-btn bg-gray-700 hover:bg-gray-600 p-3 rounded-lg text-white font-semibold" data-amount="50">₹50</button>
                            <button class="bet-amount-btn bg-gray-700 hover:bg-gray-600 p-3 rounded-lg text-white font-semibold" data-amount="100">₹100</button>
                            <button class="bet-amount-btn bg-gray-700 hover:bg-gray-600 p-3 rounded-lg text-white font-semibold" data-amount="500">₹500</button>
                        </div>
                        <input type="number" id="customAmount" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Enter custom amount" min="1">
                    </div>

                    <!-- Selected Bet Display -->
                    <div id="selectedBet" class="bg-gray-700 p-4 rounded-lg mb-4 hidden">
                        <div class="text-sm text-gray-400 mb-2">Selected Bet:</div>
                        <div class="flex justify-between items-center">
                            <div>
                                <span id="selectedBetType" class="font-semibold"></span>
                                <span id="selectedBetValue" class="ml-2"></span>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold">₹<span id="selectedBetAmount">0</span></div>
                                <div class="text-sm text-gray-400">Win: ₹<span id="potentialWin">0</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Place Bet Button -->
                    <button id="placeBetBtn" class="w-full red-gradient text-white py-4 rounded-lg font-semibold text-lg disabled:opacity-50 disabled:cursor-not-allowed pulse-animation" disabled>
                        <i class="fas fa-dice mr-2"></i>Place Bet
                    </button>
                </div>

                <!-- Recent Results -->
                <div class="bg-gray-800 rounded-xl p-6 mb-6">
                    <h3 class="text-lg font-semibold text-white mb-4">
                        <i class="fas fa-history mr-2"></i>Recent Results
                    </h3>
                    <div id="recentResults" class="flex overflow-x-auto space-x-3 pb-2">
                        <!-- Results will be displayed here -->
                    </div>
                </div>

                <!-- My Bets -->
                <div class="bg-gray-800 rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-white mb-4">
                        <i class="fas fa-chart-line mr-2"></i>My Bets
                    </h3>
                    <div id="myBets" class="space-y-3">
                        <div class="text-center text-gray-400 py-8">
                            <i class="fas fa-chart-line text-4xl mb-3"></i>
                            <p>No bets placed yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Wallet Tab Content -->
        <div id="walletTabContent" class="tab-content container mx-auto px-4 py-6 pb-20">
            <h2 class="text-2xl font-bold text-white mb-6">
                <i class="fas fa-wallet mr-2"></i>Wallet
            </h2>
            
            <!-- Balance Card -->
            <div class="balance-card rounded-xl p-6 mb-6 text-center">
                <div class="text-gray-400 text-sm mb-2">Available Balance</div>
                <div class="text-4xl font-bold text-white mb-4">₹<span id="walletBalance">0.00</span></div>
                <div class="grid grid-cols-2 gap-4">
                    <button id="depositBtn" class="green-gradient text-white py-3 rounded-lg font-semibold">
                        <i class="fas fa-plus mr-2"></i>Deposit
                    </button>
                    <button id="withdrawBtn" class="red-gradient text-white py-3 rounded-lg font-semibold">
                        <i class="fas fa-minus mr-2"></i>Withdraw
                    </button>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="bg-gray-800 rounded-xl p-6 mb-6">
                <h3 class="text-lg font-semibold text-white mb-4">Quick Deposit</h3>
                <div class="grid grid-cols-4 gap-3">
                    <button class="quick-deposit bg-gray-700 hover:bg-gray-600 p-3 rounded-lg text-white font-semibold" data-amount="100">₹100</button>
                    <button class="quick-deposit bg-gray-700 hover:bg-gray-600 p-3 rounded-lg text-white font-semibold" data-amount="500">₹500</button>
                    <button class="quick-deposit bg-gray-700 hover:bg-gray-600 p-3 rounded-lg text-white font-semibold" data-amount="1000">₹1000</button>
                    <button class="quick-deposit bg-gray-700 hover:bg-gray-600 p-3 rounded-lg text-white font-semibold" data-amount="5000">₹5000</button>
                </div>
            </div>

            <!-- Transaction History -->
            <div class="bg-gray-800 rounded-xl p-6">
                <h3 class="text-lg font-semibold text-white mb-4">Recent Transactions</h3>
                <div id="transactionHistory" class="space-y-3">
                    <div class="text-center text-gray-400 py-8">
                        <i class="fas fa-receipt text-4xl mb-3"></i>
                        <p>No transactions yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Tab Content -->
        <div id="historyTabContent" class="tab-content container mx-auto px-4 py-6 pb-20">
            <h2 class="text-2xl font-bold text-white mb-6">
                <i class="fas fa-history mr-2"></i>Betting History
            </h2>
            
            <!-- Filter Tabs -->
            <div class="flex space-x-2 mb-6">
                <button class="history-filter-btn bg-red-600 text-white px-4 py-2 rounded-lg active" data-filter="all">All</button>
                <button class="history-filter-btn bg-gray-700 text-white px-4 py-2 rounded-lg" data-filter="win">Won</button>
                <button class="history-filter-btn bg-gray-700 text-white px-4 py-2 rounded-lg" data-filter="loss">Lost</button>
                <button class="history-filter-btn bg-gray-700 text-white px-4 py-2 rounded-lg" data-filter="pending">Pending</button>
            </div>

            <!-- Statistics Cards -->
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-gray-800 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-white" id="userTotalBets">0</div>
                    <div class="text-sm text-gray-400">Total Bets</div>
                </div>
                <div class="bg-gray-800 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-green-400" id="userWinRate">0%</div>
                    <div class="text-sm text-gray-400">Win Rate</div>
                </div>
            </div>

            <!-- Betting History -->
            <div id="bettingHistory" class="space-y-4">
                <div class="text-center text-gray-400 py-8">
                    <i class="fas fa-chart-line text-4xl mb-3"></i>
                    <p>No betting history found</p>
                </div>
            </div>
        </div>

        <!-- Gift Tab Content -->
        <div id="giftTabContent" class="tab-content container mx-auto px-4 py-6 pb-20">
            <h2 class="text-2xl font-bold text-white mb-6">
                <i class="fas fa-gift mr-2"></i>Gift Codes
            </h2>
            
            <!-- Gift Code Input -->
            <div class="bg-gray-800 rounded-xl p-6 mb-6">
                <h3 class="text-lg font-semibold text-white mb-4">Redeem Gift Code</h3>
                <div class="space-y-4">
                    <input type="text" id="giftCodeInput" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white uppercase" placeholder="Enter gift code" maxlength="20">
                    <button id="redeemGiftBtn" class="w-full green-gradient text-white py-3 rounded-lg font-semibold">
                        <i class="fas fa-gift mr-2"></i>Redeem Code
                    </button>
                </div>
            </div>

            <!-- Gift Code History -->
            <div class="bg-gray-800 rounded-xl p-6">
                <h3 class="text-lg font-semibold text-white mb-4">Redeemed Codes</h3>
                <div id="giftCodeHistory" class="space-y-3">
                    <div class="text-center text-gray-400 py-8">
                        <i class="fas fa-gift text-4xl mb-3"></i>
                        <p>No gift codes redeemed yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Tab Content -->
        <div id="profileTabContent" class="tab-content container mx-auto px-4 py-6 pb-20">
            <h2 class="text-2xl font-bold text-white mb-6">
                <i class="fas fa-user mr-2"></i>Profile
            </h2>
            
            <!-- User Info -->
            <div class="bg-gray-800 rounded-xl p-6 mb-6">
                <div class="flex items-center space-x-4 mb-4">
                    <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center online-indicator">
                        <i class="fas fa-user text-2xl text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-white" id="profileName">User Name</h3>
                        <p class="text-gray-400" id="profilePhone">+91 9876543210</p>
                        <p class="text-sm text-green-400">Online</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-3 gap-4 pt-4 border-t border-gray-700">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-white" id="totalBets">0</div>
                        <div class="text-sm text-gray-400">Total Bets</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-400" id="totalWins">0</div>
                        <div class="text-sm text-gray-400">Wins</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-red-400" id="winRate">0%</div>
                        <div class="text-sm text-gray-400">Win Rate</div>
                    </div>
                </div>
            </div>

            <!-- Account Settings -->
            <div class="bg-gray-800 rounded-xl p-6 mb-6">
                <h3 class="text-lg font-semibold text-white mb-4">Account Settings</h3>
                <div class="space-y-3">
                    <button id="changePasswordBtn" class="w-full flex items-center justify-between p-3 bg-gray-700 rounded-lg text-white hover:bg-gray-600">
                        <div class="flex items-center">
                            <i class="fas fa-key mr-3"></i>
                            <span>Change Password</span>
                        </div>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <button class="w-full flex items-center justify-between p-3 bg-gray-700 rounded-lg text-white hover:bg-gray-600">
                        <div class="flex items-center">
                            <i class="fas fa-credit-card mr-3"></i>
                            <span>Payment Methods</span>
                        </div>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <button id="customerSupportBtn" class="w-full flex items-center justify-between p-3 bg-gray-700 rounded-lg text-white hover:bg-gray-600">
                        <div class="flex items-center">
                            <i class="fas fa-headset mr-3"></i>
                            <span>Customer Support</span>
                        </div>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Logout Button -->
            <button id="logoutBtn" class="w-full red-gradient text-white py-4 rounded-lg font-semibold">
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </button>
        </div>

        <!-- Mobile Bottom Navigation -->
        <div class="mobile-nav">
            <div class="grid grid-cols-5 h-16">
                <button class="nav-btn flex flex-col items-center justify-center text-white active" data-tab="game">
                    <i class="fas fa-gamepad text-xl"></i>
                    <span class="text-xs mt-1">Game</span>
                </button>
                <button class="nav-btn flex flex-col items-center justify-center text-gray-400" data-tab="wallet">
                    <i class="fas fa-wallet text-xl"></i>
                    <span class="text-xs mt-1">Wallet</span>
                </button>
                <button class="nav-btn flex flex-col items-center justify-center text-gray-400" data-tab="history">
                    <i class="fas fa-history text-xl"></i>
                    <span class="text-xs mt-1">History</span>
                </button>
                <button class="nav-btn flex flex-col items-center justify-center text-gray-400" data-tab="gift">
                    <i class="fas fa-gift text-xl"></i>
                    <span class="text-xs mt-1">Gift</span>
                </button>
                <button class="nav-btn flex flex-col items-center justify-center text-gray-400" data-tab="profile">
                    <i class="fas fa-user text-xl"></i>
                    <span class="text-xs mt-1">Profile</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Back Button -->
    <button id="backButton" class="back-button w-12 h-12 rounded-full border-2 border-gray-600 text-white hover:bg-gray-700 hidden">
        <i class="fas fa-arrow-left"></i>
    </button>

    <!-- Deposit Modal -->
    <div id="depositModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold text-white">Deposit Money</h3>
                    <button id="closeDepositModal" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Amount (₹)</label>
                        <input type="number" id="depositAmount" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Enter amount" min="1">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">UTR Number</label>
                        <input type="text" id="utrNumber" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Enter UTR number">
                    </div>
                    
                    <div class="bg-yellow-100 border border-yellow-400 text-yellow-800 px-4 py-3 rounded">
                        <p class="text-sm font-semibold">Pay to UPI ID: <span class="text-blue-600">9934406008@ptsbi</span></p>
                        <p class="text-sm mt-1">Enter UTR number after payment</p>
                    </div>
                </div>
                
                <div class="flex space-x-4 mt-6">
                    <button id="cancelDeposit" class="flex-1 border border-gray-600 text-gray-300 py-3 rounded-lg hover:bg-gray-700">Cancel</button>
                    <button id="confirmDeposit" class="flex-1 green-gradient text-white py-3 rounded-lg">Confirm Deposit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold text-white">Withdraw Money</h3>
                    <button id="closeWithdrawModal" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Amount (₹)</label>
                        <input type="number" id="withdrawAmount" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Enter amount" min="100">
                        <p class="text-xs text-gray-400 mt-1">Minimum withdrawal: ₹100</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">UPI ID</label>
                        <input type="text" id="withdrawUpi" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Enter UPI ID">
                    </div>
                </div>
                
                <div class="flex space-x-4 mt-6">
                    <button id="cancelWithdraw" class="flex-1 border border-gray-600 text-gray-300 py-3 rounded-lg hover:bg-gray-700">Cancel</button>
                    <button id="confirmWithdraw" class="flex-1 red-gradient text-white py-3 rounded-lg">Request Withdrawal</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold text-white">Change Password</h3>
                    <button id="closeChangePasswordModal" class="text-gray-400 hover:text-white">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Current Password</label>
                        <input type="password" id="currentPassword" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Enter current password">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">New Password</label>
                        <input type="password" id="newPasswordChange" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Enter new password">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Confirm New Password</label>
                        <input type="password" id="confirmNewPassword" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Confirm new password">
                    </div>
                    
                    <div id="changePasswordError" class="text-red-400 text-sm hidden">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        <span></span>
                    </div>
                </div>
                
                <div class="flex space-x-4 mt-6">
                    <button id="cancelChangePassword" class="flex-1 border border-gray-600 text-gray-300 py-3 rounded-lg hover:bg-gray-700">Cancel</button>
                    <button id="confirmChangePassword" class="flex-1 green-gradient text-white py-3 rounded-lg">Change Password</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentPeriod = null;
        let timeLeft = 30;
        let gameTimer = null;
        let selectedBet = null;
        let bettingEnabled = true;
        let currentTab = 'game';
        let onlineUsers = 0;
        let heartbeatInterval = null;
        let lastSyncTime = 0;
        let dataSyncQueue = [];

        // Storage keys
        const STORAGE_KEYS = {
            currentUser: 'wavewin_current_user',
            users: 'wavewin_users',
            withdrawals: 'wavewin_withdrawals',
            deposits: 'wavewin_deposits',
            giftCodes: 'wavewin_gift_codes',
            bets: 'wavewin_bets',
            results: 'wavewin_game_results',
            adminControls: 'wavewin_admin_controls',
            onlineUsers: 'wavewin_online_users',
            userSessions: 'wavewin_user_sessions',
            lastResult: 'wavewin_last_result',
            userRegistrations: 'wavewin_user_registrations'
        };

        // Enhanced Data Management Class
        class DataManager {
            static setData(key, data) {
                try {
                    const timestamp = Date.now();
                    const dataToStore = { data, timestamp };
                    localStorage.setItem(key, JSON.stringify(dataToStore));
                    
                    // Show sync indicator
                    this.showSyncIndicator();
                    
                    // Trigger cross-tab communication
                    window.dispatchEvent(new CustomEvent('dataUpdate', {
                        detail: { key, data, timestamp }
                    }));
                    
                    // Also trigger storage event for cross-tab compatibility
                    window.dispatchEvent(new StorageEvent('storage', {
                        key: key,
                        newValue: localStorage.getItem(key),
                        oldValue: null,
                        url: window.location.href
                    }));
                } catch (error) {
                    console.error('Error saving data:', error);
                }
            }

            static getData(key) {
                try {
                    const item = localStorage.getItem(key);
                    if (!item) return null;
                    const parsed = JSON.parse(item);
                    return parsed.data;
                } catch (error) {
                    console.error('Error loading data:', error);
                    return null;
                }
            }

            static showSyncIndicator() {
                const indicator = document.getElementById('dataSyncIndicator');
                indicator.classList.add('show');
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 1000);
            }

            static userExists(phone) {
                const users = this.getData(STORAGE_KEYS.users) || {};
                return users.hasOwnProperty(phone);
            }

            static saveUser(userData) {
                // Enhanced user saving with session management
                userData.lastLogin = new Date().toISOString();
                userData.sessionId = Date.now().toString();
                userData.lastUpdated = new Date().toISOString();
                
                // Save in users collection
                const users = this.getData(STORAGE_KEYS.users) || {};
                users[userData.phone] = userData;
                this.setData(STORAGE_KEYS.users, users);
                
                // Update user sessions
                this.updateUserSession(userData.phone, userData.sessionId);
                
                return userData;
            }

            static getUser(phone) {
                const users = this.getData(STORAGE_KEYS.users) || {};
                return users[phone] || null;
            }

            static updateUserBalance(phone, newBalance) {
                const users = this.getData(STORAGE_KEYS.users) || {};
                if (users[phone]) {
                    users[phone].balance = newBalance;
                    users[phone].lastUpdated = new Date().toISOString();
                    this.setData(STORAGE_KEYS.users, users);
                    return true;
                }
                return false;
            }

            static updateUserSession(phone, sessionId) {
                const sessions = this.getData(STORAGE_KEYS.userSessions) || {};
                sessions[phone] = {
                    sessionId,
                    lastSeen: Date.now(),
                    isActive: true
                };
                this.setData(STORAGE_KEYS.userSessions, sessions);
            }

            static getOnlineUsers() {
                const sessions = this.getData(STORAGE_KEYS.userSessions) || {};
                const now = Date.now();
                const activeThreshold = 60000; // 1 minute
                
                return Object.values(sessions).filter(session => 
                    session.isActive && (now - session.lastSeen) < activeThreshold
                ).length;
            }

            static updateOnlineStatus() {
                if (currentUser) {
                    this.updateUserSession(currentUser.phone, currentUser.sessionId || Date.now().toString());
                }
            }

            static getAllUsers() {
                const users = this.getData(STORAGE_KEYS.users) || {};
                return Object.values(users);
            }

            static getUserByPhone(phone) {
                const users = this.getData(STORAGE_KEYS.users) || {};
                return users[phone] || null;
            }

            static updateUser(phone, updates) {
                const users = this.getData(STORAGE_KEYS.users) || {};
                if (users[phone]) {
                    Object.assign(users[phone], updates);
                    users[phone].lastUpdated = new Date().toISOString();
                    this.setData(STORAGE_KEYS.users, users);
                    return true;
                }
                return false;
            }
        }

        // Enhanced Notification System
        class NotificationManager {
            static show(message, type = 'success', duration = 3000) {
                const notification = document.getElementById('notification');
                const content = document.getElementById('notificationContent');
                const text = document.getElementById('notificationText');
                
                // Set notification style based on type
                const styles = {
                    success: 'bg-green-500',
                    error: 'bg-red-500',
                    warning: 'bg-yellow-500',
                    info: 'bg-blue-500'
                };
                
                content.className = `px-6 py-3 rounded-lg shadow-lg ${styles[type]} text-white`;
                text.textContent = message;
                notification.classList.remove('hidden');

                // Auto-hide after duration
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, duration);
            }

            static success(message, duration = 3000) {
                this.show(message, 'success', duration);
            }

            static error(message, duration = 3000) {
                this.show(message, 'error', duration);
            }

            static warning(message, duration = 3000) {
                this.show(message, 'warning', duration);
            }

            static info(message, duration = 3000) {
                this.show(message, 'info', duration);
            }
        }

        // Enhanced Game Engine
        class GameEngine {
            static generatePeriod() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = now.getHours();
                const minutes = now.getMinutes();
                const seconds = now.getSeconds();
                const totalSeconds = (hours * 3600) + (minutes * 60) + seconds;
                const roundNumber = Math.floor(totalSeconds / 30) + 1;
                return parseInt(`${year}${month}${day}${String(roundNumber).padStart(4, '0')}`);
            }

            static getTimeLeft() {
                const now = new Date();
                const seconds = now.getSeconds();
                return 30 - (seconds % 30);
            }

            static generateResult() {
                // Check for admin controls
                const adminControls = DataManager.getData(STORAGE_KEYS.adminControls);
                if (adminControls && adminControls.nextResult !== undefined) {
                    const result = adminControls.nextResult;
                    // Clear the admin control after use
                    DataManager.setData(STORAGE_KEYS.adminControls, {});
                    return result;
                }
                
                // Generate weighted random result for better game balance
                const weights = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]; // Equal weights for fair play
                const totalWeight = weights.reduce((sum, weight) => sum + weight, 0);
                let random = Math.random() * totalWeight;
                
                for (let i = 0; i < weights.length; i++) {
                    random -= weights[i];
                    if (random <= 0) {
                        return i;
                    }
                }
                
                return Math.floor(Math.random() * 10);
            }

            static getNumberColor(number) {
                if (number === 0 || number === 5) return 'violet';
                if (number === 1 || number === 3 || number === 7 || number === 9) return 'green';
                return 'red';
            }

            static getNumberSize(number) {
                return number >= 5 ? 'big' : 'small';
            }

            static processGameResult(period, result) {
                const color = this.getNumberColor(result);
                const size = this.getNumberSize(result);
                
                const gameResult = {
                    period: period,
                    number: result,
                    color: color,
                    size: size,
                    time: new Date().toLocaleTimeString(),
                    timestamp: Date.now()
                };

                // Save result
                const results = DataManager.getData(STORAGE_KEYS.results) || [];
                results.unshift(gameResult);
                results.splice(50); // Keep only last 50 results
                DataManager.setData(STORAGE_KEYS.results, results);

                // Save last result for synchronization
                DataManager.setData(STORAGE_KEYS.lastResult, gameResult);

                // Process bets
                this.processBets(period, result, color, size);

                return gameResult;
            }

            static processBets(period, result, color, size) {
                const bets = DataManager.getData(STORAGE_KEYS.bets) || [];
                
                bets.forEach(bet => {
                    if (bet.period === period && bet.status === 'pending') {
                        let isWin = false;
                        let winAmount = 0;

                        // Check win conditions
                        if (bet.type === 'color' && bet.value === color) {
                            isWin = true;
                            winAmount = bet.amount * bet.multiplier;
                        } else if (bet.type === 'number' && bet.value == result) {
                            isWin = true;
                            winAmount = bet.amount * bet.multiplier;
                        } else if (bet.type === 'size' && bet.value === size) {
                            isWin = true;
                            winAmount = bet.amount * bet.multiplier;
                        }

                        bet.status = isWin ? 'win' : 'loss';
                        bet.winAmount = winAmount;
                        bet.result = result;
                        bet.resultColor = color;
                        bet.resultSize = size;
                        bet.processedAt = new Date().toISOString();

                        // Update user balance if win
                        if (isWin) {
                            DataManager.updateUserBalance(bet.phone, 
                                (DataManager.getUser(bet.phone)?.balance || 0) + winAmount);
                        }
                    }
                });

                DataManager.setData(STORAGE_KEYS.bets, bets);
            }

            static getActiveBetsCount() {
                const bets = DataManager.getData(STORAGE_KEYS.bets) || [];
                return bets.filter(bet => bet.status === 'pending').length;
            }

            static getTodaysBets() {
                const bets = DataManager.getData(STORAGE_KEYS.bets) || [];
                const today = new Date().toDateString();
                return bets.filter(bet => new Date(bet.date).toDateString() === today);
            }
        }

        // Real-time Communication System
        class RealtimeManager {
            static init() {
                // Listen for data updates
                window.addEventListener('dataUpdate', this.handleDataUpdate.bind(this));
                window.addEventListener('storage', this.handleStorageUpdate.bind(this));
                
                // Start heartbeat
                this.startHeartbeat();
            }

            static handleDataUpdate(event) {
                const { key, data } = event.detail;
                this.processUpdate(key, data);
            }

            static handleStorageUpdate(event) {
                if (event.key && event.key.startsWith('wavewin_')) {
                    try {
                        const data = event.newValue ? JSON.parse(event.newValue).data : null;
                        this.processUpdate(event.key, data);
                    } catch (error) {
                        console.error('Error processing storage update:', error);
                    }
                }
            }

            static processUpdate(key, data) {
                // Update UI based on data changes
                if (key === STORAGE_KEYS.userSessions) {
                    this.updateOnlineCount();
                } else if (key === STORAGE_KEYS.results) {
                    this.updateGameResults();
                } else if (key === STORAGE_KEYS.bets) {
                    this.updateBetsData();
                } else if (key === STORAGE_KEYS.lastResult) {
                    this.handleNewResult(data);
                } else if (key === STORAGE_KEYS.users && currentUser) {
                    this.updateUserData();
                }
            }

            static updateOnlineCount() {
                const count = DataManager.getOnlineUsers();
                document.getElementById('onlineCount').textContent = count;
                document.getElementById('activeUsers').textContent = count;
                onlineUsers = count;
            }

            static updateGameResults() {
                if (currentTab === 'game') {
                    loadRecentResults();
                }
            }

            static updateBetsData() {
                if (currentUser) {
                    loadMyBets();
                    updateActiveBetsCount();
                }
            }

            static handleNewResult(result) {
                if (result && currentUser) {
                    // Show result notification
                    this.showResultNotification(result);
                    // Update user data after result processing
                    setTimeout(() => {
                        updateUserDataUI();
                    }, 1000);
                }
            }

            static showResultNotification(result) {
                const resultElement = document.createElement('div');
                resultElement.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gray-800 border-2 border-red-500 rounded-xl p-6 z-50 text-center slide-in';
                resultElement.innerHTML = `
                    <div class="text-white text-xl font-bold mb-2">Period ${result.period}</div>
                    <div class="text-4xl font-bold mb-2" style="color: ${getColorCode(result.color)}">${result.number}</div>
                    <div class="text-white">${result.color.toUpperCase()} • ${result.size.toUpperCase()}</div>
                `;
                document.body.appendChild(resultElement);
                
                setTimeout(() => {
                    if (document.body.contains(resultElement)) {
                        document.body.removeChild(resultElement);
                    }
                }, 3000);
            }

            static updateUserData() {
                if (currentUser) {
                    const userData = DataManager.getUser(currentUser.phone);
                    if (userData) {
                        currentUser = userData;
                        DataManager.setData(STORAGE_KEYS.currentUser, userData);
                        updateUserDataUI();
                    }
                }
            }

            static startHeartbeat() {
                // Update online status every 30 seconds
                heartbeatInterval = setInterval(() => {
                    DataManager.updateOnlineStatus();
                    this.updateOnlineCount();
                }, 30000);
            }

            static stopHeartbeat() {
                if (heartbeatInterval) {
                    clearInterval(heartbeatInterval);
                    heartbeatInterval = null;
                }
            }
        }

        // Initialize the application
        function init() {
            setupEventListeners();
            checkLoginStatus();
            startGameTimer();
            RealtimeManager.init();
            createDemoData();
            
            // Update online count immediately
            setTimeout(() => {
                DataManager.updateOnlineStatus();
                RealtimeManager.updateOnlineCount();
            }, 100);
        }

        // Create demo data if none exists
        function createDemoData() {
            // Create demo gift codes
            const giftCodes = DataManager.getData(STORAGE_KEYS.giftCodes) || {};
            if (Object.keys(giftCodes).length === 0) {
                const demoCodes = {
                    'WELCOME100': {
                        name: 'Welcome Bonus',
                        amount: 100,
                        expiry: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                        created: new Date().toISOString(),
                        used: false,
                        usedBy: null
                    },
                    'NEWUSER50': {
                        name: 'New User Bonus',
                        amount: 50,
                        expiry: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                        created: new Date().toISOString(),
                        used: false,
                        usedBy: null
                    }
                };
                DataManager.setData(STORAGE_KEYS.giftCodes, demoCodes);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Auth events
            document.getElementById('showSignup').addEventListener('click', () => {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('signupForm').classList.remove('hidden');
                document.getElementById('forgotPasswordForm').classList.add('hidden');
            });

            document.getElementById('showLogin').addEventListener('click', () => {
                document.getElementById('signupForm').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('forgotPasswordForm').classList.add('hidden');
            });

            document.getElementById('showForgotPassword').addEventListener('click', () => {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('signupForm').classList.add('hidden');
                document.getElementById('forgotPasswordForm').classList.remove('hidden');
            });

            document.getElementById('showLoginFromForgot').addEventListener('click', () => {
                document.getElementById('forgotPasswordForm').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
            });

            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('signupBtn').addEventListener('click', handleSignup);
            document.getElementById('resetPasswordBtn').addEventListener('click', handleResetPassword);

            // Back button
            document.getElementById('backButton').addEventListener('click', () => {
                switchTab('game');
            });

            // Game events
            document.querySelectorAll('.bet-color-btn').forEach(btn => {
                btn.addEventListener('click', () => selectColorBet(btn));
            });

            document.querySelectorAll('.bet-number-btn').forEach(btn => {
                btn.addEventListener('click', () => selectNumberBet(btn));
            });

            document.querySelectorAll('.bet-size-btn').forEach(btn => {
                btn.addEventListener('click', () => selectSizeBet(btn));
            });

            document.querySelectorAll('.bet-amount-btn').forEach(btn => {
                btn.addEventListener('click', () => selectBetAmount(btn));
            });

            document.getElementById('customAmount').addEventListener('input', handleCustomAmount);
            document.getElementById('placeBetBtn').addEventListener('click', placeBet);

            // Navigation events
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.tab));
            });

            // Wallet events
            document.getElementById('depositBtn').addEventListener('click', openDepositModal);
            document.getElementById('withdrawBtn').addEventListener('click', openWithdrawModal);
            document.getElementById('closeDepositModal').addEventListener('click', closeDepositModal);
            document.getElementById('closeWithdrawModal').addEventListener('click', closeWithdrawModal);
            document.getElementById('confirmDeposit').addEventListener('click', handleDeposit);
            document.getElementById('confirmWithdraw').addEventListener('click', handleWithdraw);
            document.getElementById('cancelDeposit').addEventListener('click', closeDepositModal);
            document.getElementById('cancelWithdraw').addEventListener('click', closeWithdrawModal);

            // Quick deposit
            document.querySelectorAll('.quick-deposit').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById('depositAmount').value = btn.dataset.amount;
                    openDepositModal();
                });
            });

            // Gift code events
            document.getElementById('redeemGiftBtn').addEventListener('click', redeemGiftCode);

            // Profile events
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.getElementById('changePasswordBtn').addEventListener('click', openChangePasswordModal);
            document.getElementById('closeChangePasswordModal').addEventListener('click', closeChangePasswordModal);
            document.getElementById('confirmChangePassword').addEventListener('click', handleChangePassword);
            document.getElementById('cancelChangePassword').addEventListener('click', closeChangePasswordModal);
            document.getElementById('customerSupportBtn').addEventListener('click', () => {
                window.open('https://t.me/OFFICIALNAITIK2', '_blank');
            });

            // Enter key support
            document.getElementById('loginPhone').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            document.getElementById('loginPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });

            // History filter buttons
            document.querySelectorAll('.history-filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.history-filter-btn').forEach(b => {
                        b.classList.remove('bg-red-600', 'active');
                        b.classList.add('bg-gray-700');
                    });
                    btn.classList.remove('bg-gray-700');
                    btn.classList.add('bg-red-600', 'active');
                    
                    const filter = btn.dataset.filter;
                    const bets = DataManager.getData(STORAGE_KEYS.bets) || [];
                    let userBets = bets.filter(bet => bet.phone === currentUser.phone)
                                      .sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    if (filter !== 'all') {
                        userBets = userBets.filter(bet => bet.status === filter);
                    }
                    
                    displayBettingHistory(userBets);
                });
            });

            // Prevent form submission on Enter
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                    }
                });
            });
        }

        // Check login status
        function checkLoginStatus() {
            const savedUser = DataManager.getData(STORAGE_KEYS.currentUser);
            if (savedUser) {
                // Verify the user still exists in the database
                const userFromDB = DataManager.getUser(savedUser.phone);
                if (userFromDB) {
                    currentUser = userFromDB;
                    DataManager.setData(STORAGE_KEYS.currentUser, userFromDB);
                    showGameScreen();
                    return;
                }
            }
            // If no valid user found, show auth screen
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('realtimeStatus').textContent = 'Offline';
        }

        // Handle login
        function handleLogin() {
            const phone = document.getElementById('loginPhone').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const errorElement = document.getElementById('loginError');

            if (!phone || !password) {
                showError(errorElement, 'Please enter phone and password');
                return;
            }

            if (phone.length !== 10 || !/^\d{10}$/.test(phone)) {
                showError(errorElement, 'Please enter a valid 10-digit phone number');
                return;
            }

            const user = DataManager.getUser(phone);
            if (!user || user.password !== password) {
                showError(errorElement, 'Invalid phone number or password');
                return;
            }

            currentUser = DataManager.saveUser(user);
            DataManager.setData(STORAGE_KEYS.currentUser, currentUser);
            hideError(errorElement);
            showGameScreen();
            NotificationManager.success('Login successful!');
        }

        // Handle signup
        function handleSignup() {
            const name = document.getElementById('signupName').value.trim();
            const phone = document.getElementById('signupPhone').value.trim();
            const password = document.getElementById('signupPassword').value.trim();
            const errorElement = document.getElementById('signupError');

            if (!name || !phone || !password) {
                showError(errorElement, 'Please fill in all fields');
                return;
            }

            if (name.length < 2) {
                showError(errorElement, 'Name must be at least 2 characters');
                return;
            }

            if (phone.length !== 10 || !/^\d{10}$/.test(phone)) {
                showError(errorElement, 'Please enter a valid 10-digit phone number');
                return;
            }

            if (password.length < 6) {
                showError(errorElement, 'Password must be at least 6 characters');
                return;
            }

            // Check if user already exists
            if (DataManager.userExists(phone)) {
                showError(errorElement, 'Phone number already registered');
                return;
            }

            // Create new user
            const newUser = {
                name: name,
                phone: phone,
                password: password,
                balance: 100, // Welcome bonus
                totalBets: 0,
                totalWins: 0,
                joinDate: new Date().toISOString(),
                isNew: true
            };

            currentUser = DataManager.saveUser(newUser);
            DataManager.setData(STORAGE_KEYS.currentUser, currentUser);
            
            hideError(errorElement);
            showGameScreen();
            NotificationManager.success('Account created successfully! Welcome bonus ₹100 added!');
        }

        // Handle reset password
        function handleResetPassword() {
            const phone = document.getElementById('forgotPhone').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            const errorElement = document.getElementById('forgotError');

            if (!phone || !newPassword) {
                showError(errorElement, 'Please enter phone and new password');
                return;
            }

            if (phone.length !== 10 || !/^\d{10}$/.test(phone)) {
                showError(errorElement, 'Please enter a valid 10-digit phone number');
                return;
            }

            if (newPassword.length < 6) {
                showError(errorElement, 'Password must be at least 6 characters');
                return;
            }

            if (!DataManager.userExists(phone)) {
                showError(errorElement, 'Phone number not registered');
                return;
            }

            // Update password
            DataManager.updateUser(phone, { password: newPassword });
            
            hideError(errorElement);
            document.getElementById('forgotPasswordForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            NotificationManager.success('Password reset successful! Please login with new password');
        }

        // Show/hide error messages
        function showError(element, message) {
            element.querySelector('span').textContent = message;
            element.classList.remove('hidden');
        }

        function hideError(element) {
            element.classList.add('hidden');
        }

        // Show game screen
        function showGameScreen() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('realtimeStatus').textContent = 'Online';
            
            switchTab('game');
            updateUserDataUI();
            updateGameData();
            loadRecentResults();
            loadMyBets();
            updateActiveBetsCount();
        }

        // Update user data in UI
        function updateUserDataUI() {
            if (!currentUser) return;

            // Refresh user data from storage
            const userData = DataManager.getUser(currentUser.phone);
            if (userData) {
                currentUser = userData;
                DataManager.setData(STORAGE_KEYS.currentUser, userData);
            }

            // Update balance displays
            document.getElementById('userBalance').textContent = currentUser.balance.toFixed(2);
            document.getElementById('walletBalance').textContent = currentUser.balance.toFixed(2);
            
            // Update profile info
            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('profilePhone').textContent = `+91 ${currentUser.phone}`;
            
            // Update stats
            const bets = DataManager.getData(STORAGE_KEYS.bets) || [];
            const userBets = bets.filter(bet => bet.phone === currentUser.phone);
            const wins = userBets.filter(bet => bet.status === 'win').length;
            const winRate = userBets.length > 0 ? ((wins / userBets.length) * 100).toFixed(1) : 0;
            
            document.getElementById('totalBets').textContent = userBets.length;
            document.getElementById('totalWins').textContent = wins;
            document.getElementById('winRate').textContent = winRate + '%';
            
            // Update history stats
            document.getElementById('userTotalBets').textContent = userBets.length;
            document.getElementById('userWinRate').textContent = winRate + '%';
        }

        // Update game data
        function updateGameData() {
            currentPeriod = GameEngine.generatePeriod();
            document.getElementById('currentPeriod').textContent = currentPeriod;
        }

        // Update active bets count
        function updateActiveBetsCount() {
            const activeBets = GameEngine.getActiveBetsCount();
            document.getElementById('activeBetsCount').textContent = activeBets;
        }

        // Start game timer
        function startGameTimer() {
            gameTimer = setInterval(() => {
                timeLeft = GameEngine.getTimeLeft();
                
                // Update countdown display
                document.getElementById('countdown').textContent = timeLeft;
                
                // Update countdown circle
                const progress = ((30 - timeLeft) / 30) * 360;
                document.querySelector('.countdown-circle').style.setProperty('--progress', progress + 'deg');

                // Update betting status
                if (timeLeft <= 5) {
                    bettingEnabled = false;
                    document.getElementById('bettingStatus').innerHTML = 
                        '<i class="fas fa-circle text-red-400 mr-2"></i>Betting Closed';
                    document.getElementById('bettingSection').classList.add('betting-disabled');
                } else {
                    bettingEnabled = true;
                    document.getElementById('bettingStatus').innerHTML = 
                        '<i class="fas fa-circle text-green-400 mr-2"></i>Betting Open';
                    document.getElementById('bettingSection').classList.remove('betting-disabled');
                }

                // Update place bet button
                updateSelectedBetDisplay();

                // Process result when timer hits 0
                if (timeLeft === 1) {
                    processGameResult();
                }

                // Reset for new round
                if (timeLeft === 30) {
                    updateGameData();
                    selectedBet = null;
                    clearBetSelection();
                    updateSelectedBetDisplay();
                }
            }, 1000);
        }

        // Process game result
        function processGameResult() {
            const result = GameEngine.generateResult();
            const gameResult = GameEngine.processGameResult(currentPeriod, result);
            
            // Update UI
            loadRecentResults();
            loadMyBets();
            updateUserDataUI();
            updateActiveBetsCount();
        }

        // Get color code for display
        function getColorCode(color) {
            switch(color) {
                case 'red': return '#e60000';
                case 'green': return '#10b981';
                case 'violet': return '#8b5cf6';
                default: return '#6b7280';
            }
        }

        // Load recent results
        function loadRecentResults() {
            const results = DataManager.getData(STORAGE_KEYS.results) || [];
            const container = document.getElementById('recentResults');
            
            container.innerHTML = '';
            
            if (results.length === 0) {
                container.innerHTML = '<div class="text-gray-400 text-center py-4">No results yet</div>';
                return;
            }
            
            results.slice(0, 10).forEach(result => {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'result-ball flex-shrink-0';
                resultDiv.textContent = result.number;
                resultDiv.style.backgroundColor = getColorCode(result.color);
                resultDiv.title = `Period: ${result.period}, Color: ${result.color}, Size: ${result.size}`;
                
                container.appendChild(resultDiv);
            });
        }

        // Load my bets
        function loadMyBets() {
            if (!currentUser) return;
            
            const bets = DataManager.getData(STORAGE_KEYS.bets) || [];
            const userBets = bets.filter(bet => bet.phone === currentUser.phone)
                                 .sort((a, b) => new Date(b.date) - new Date(a.date))
                                 .slice(0, 10);
            
            const container = document.getElementById('myBets');
            
            if (userBets.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 py-8">
                        <i class="fas fa-chart-line text-4xl mb-3"></i>
                        <p>No bets placed yet</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            userBets.forEach(bet => {
                const betDiv = document.createElement('div');
                betDiv.className = `bg-gray-700 rounded-lg p-4 ${bet.status === 'win' ? 'winning-animation' : bet.status === 'loss' ? 'losing-animation' : ''}`;
                
                const statusClass = bet.status === 'pending' ? 'text-yellow-400' : 
                                   bet.status === 'win' ? 'text-green-400' : 'text-red-400';
                
                betDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <div class="text-sm text-gray-400">Period: ${bet.period}</div>
                        <div class="text-sm ${statusClass} font-semibold">${bet.status.toUpperCase()}</div>
                    </div>
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-semibold">${bet.type.toUpperCase()}: ${bet.value}</div>
                            <div class="text-sm text-gray-400">Bet: ₹${bet.amount}</div>
                        </div>
                        <div class="text-right">
                            ${bet.status === 'win' ? `<div class="text-green-400 font-semibold">+₹${bet.winAmount}</div>` : ''}
                            ${bet.result !== undefined ? `<div class="text-sm text-gray-400">Result: ${bet.result}</div>` : ''}
                        </div>
                    </div>
                `;
                
                container.appendChild(betDiv);
            });
        }

        // Clear bet selection
        function clearBetSelection() {
            document.querySelectorAll('.bet-option').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelectorAll('.bet-amount-btn').forEach(btn => {
                btn.classList.remove('bg-red-600');
                btn.classList.add('bg-gray-700');
            });
            document.getElementById('customAmount').value = '';
        }

        // Color bet selection
        function selectColorBet(button) {
            clearBetSelection();
            button.classList.add('selected');
            
            selectedBet = {
                type: 'color',
                value: button.dataset.color,
                multiplier: parseFloat(button.dataset.multiplier)
            };
            
            updateSelectedBetDisplay();
        }

        // Number bet selection
        function selectNumberBet(button) {
            clearBetSelection();
            button.classList.add('selected');
            
            selectedBet = {
                type: 'number',
                value: parseInt(button.dataset.number),
                multiplier: parseFloat(button.dataset.multiplier)
            };
            
            updateSelectedBetDisplay();
        }

        // Size bet selection
        function selectSizeBet(button) {
            clearBetSelection();
            button.classList.add('selected');
            
            selectedBet = {
                type: 'size',
                value: button.dataset.size,
                multiplier: parseFloat(button.dataset.multiplier)
            };
            
            updateSelectedBetDisplay();
        }

        // Bet amount selection
        function selectBetAmount(button) {
            document.querySelectorAll('.bet-amount-btn').forEach(btn => {
                btn.classList.remove('bg-red-600');
                btn.classList.add('bg-gray-700');
            });
            button.classList.remove('bg-gray-700');
            button.classList.add('bg-red-600');
            
            document.getElementById('customAmount').value = button.dataset.amount;
            updateSelectedBetDisplay();
        }

        // Handle custom amount input
        function handleCustomAmount() {
            document.querySelectorAll('.bet-amount-btn').forEach(btn => {
                btn.classList.remove('bg-red-600');
                btn.classList.add('bg-gray-700');
            });
            updateSelectedBetDisplay();
        }

        // Update selected bet display
        function updateSelectedBetDisplay() {
            const amount = parseFloat(document.getElementById('customAmount').value) || 0;
            const selectedBetDiv = document.getElementById('selectedBet');
            const placeBetBtn = document.getElementById('placeBetBtn');
            
            if (selectedBet && amount > 0) {
                const potentialWin = amount * selectedBet.multiplier;
                
                document.getElementById('selectedBetType').textContent = selectedBet.type.toUpperCase();
                document.getElementById('selectedBetValue').textContent = selectedBet.value;
                document.getElementById('selectedBetAmount').textContent = amount;
                document.getElementById('potentialWin').textContent = potentialWin.toFixed(2);
                
                selectedBetDiv.classList.remove('hidden');
                
                // Enable/disable place bet button
                const canBet = bettingEnabled && amount > 0 && amount <= currentUser.balance;
                placeBetBtn.disabled = !canBet;
                
                if (canBet) {
                    placeBetBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    placeBetBtn.classList.add('pulse-animation');
                } else {
                    placeBetBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    placeBetBtn.classList.remove('pulse-animation');
                }
            } else {
                selectedBetDiv.classList.add('hidden');
                placeBetBtn.disabled = true;
                placeBetBtn.classList.add('opacity-50', 'cursor-not-allowed');
                placeBetBtn.classList.remove('pulse-animation');
            }
        }

        // Place bet
        function placeBet() {
            if (!selectedBet || !bettingEnabled) {
                NotificationManager.error('Betting is currently closed');
                return;
            }
            
            const amount = parseFloat(document.getElementById('customAmount').value);
            
            if (!amount || amount <= 0) {
                NotificationManager.error('Please enter a valid bet amount');
                return;
            }
            
            if (amount > currentUser.balance) {
                NotificationManager.error('Insufficient balance');
                return;
            }
            
            // Deduct amount from balance
            currentUser.balance -= amount;
            DataManager.updateUser(currentUser.phone, { balance: currentUser.balance });
            
            // Create bet record
            const bet = {
                id: Date.now().toString(),
                phone: currentUser.phone,
                playerName: currentUser.name,
                period: currentPeriod,
                type: selectedBet.type,
                value: selectedBet.value,
                amount: amount,
                multiplier: selectedBet.multiplier,
                status: 'pending',
                date: new Date().toISOString(),
                winAmount: 0
            };
            
            // Save bet
            const bets = DataManager.getData(STORAGE_KEYS.bets) || [];
            bets.unshift(bet);
            DataManager.setData(STORAGE_KEYS.bets, bets);
            
            // Update UI
            updateUserDataUI();
            loadMyBets();
            updateActiveBetsCount();
            
            // Clear selection
            selectedBet = null;
            clearBetSelection();
            updateSelectedBetDisplay();
            
            NotificationManager.success('Bet placed successfully!');
        }

        // Switch tabs
        function switchTab(tab) {
            currentTab = tab;
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-white');
                btn.classList.add('text-gray-400');
            });
            
            const navBtn = document.querySelector(`[data-tab="${tab}"]`);
            if (navBtn) {
                navBtn.classList.remove('text-gray-400');
                navBtn.classList.add('text-white');
            }
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show/hide back button and show correct content
            const backButton = document.getElementById('backButton');
            if (tab === 'game') {
                backButton.classList.add('hidden');
                document.getElementById('gameTabContent').classList.add('active');
            } else {
                backButton.classList.remove('hidden');
                document.getElementById(tab + 'TabContent').classList.add('active');
                
                // Load tab-specific data
                if (tab === 'wallet') {
                    loadTransactionHistory();
                } else if (tab === 'history') {
                    loadBettingHistory();
                } else if (tab === 'gift') {
                    loadGiftCodeHistory();
                }
            }
        }

        // Deposit/Withdraw Modal Functions
        function openDepositModal() {
            document.getElementById('depositModal').classList.remove('hidden');
        }

        function closeDepositModal() {
            document.getElementById('depositModal').classList.add('hidden');
            document.getElementById('depositAmount').value = '';
            document.getElementById('utrNumber').value = '';
        }

        function openWithdrawModal() {
            document.getElementById('withdrawModal').classList.remove('hidden');
        }

        function closeWithdrawModal() {
            document.getElementById('withdrawModal').classList.add('hidden');
            document.getElementById('withdrawAmount').value = '';
            document.getElementById('withdrawUpi').value = '';
        }

        // Change Password Modal Functions
        function openChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.remove('hidden');
        }

        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.add('hidden');
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPasswordChange').value = '';
            document.getElementById('confirmNewPassword').value = '';
            document.getElementById('changePasswordError').classList.add('hidden');
        }

        // Handle change password
        function handleChangePassword() {
            const currentPassword = document.getElementById('currentPassword').value.trim();
            const newPassword = document.getElementById('newPasswordChange').value.trim();
            const confirmPassword = document.getElementById('confirmNewPassword').value.trim();
            const errorElement = document.getElementById('changePasswordError');

            if (!currentPassword || !newPassword || !confirmPassword) {
                showError(errorElement, 'Please fill all fields');
                return;
            }

            if (currentUser.password !== currentPassword) {
                showError(errorElement, 'Current password is incorrect');
                return;
            }

            if (newPassword.length < 6) {
                showError(errorElement, 'Password must be at least 6 characters');
                return;
            }

            if (newPassword !== confirmPassword) {
                showError(errorElement, 'New passwords do not match');
                return;
            }

            // Update password
            currentUser.password = newPassword;
            DataManager.updateUser(currentUser.phone, { password: newPassword });
            
            closeChangePasswordModal();
            NotificationManager.success('Password changed successfully!');
        }

        // Handle deposit
        function handleDeposit() {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const utr = document.getElementById('utrNumber').value.trim();
            
            if (!amount || amount <= 0) {
                NotificationManager.error('Please enter a valid amount');
                return;
            }
            
            if (amount < 10) {
                NotificationManager.error('Minimum deposit amount is ₹10');
                return;
            }
            
            if (!utr) {
                NotificationManager.error('Please enter UTR number');
                return;
            }
            
            // Create deposit record
            const deposit = {
                id: Date.now().toString(),
                phone: currentUser.phone,
                name: currentUser.name,
                amount: amount,
                utr: utr,
                date: new Date().toISOString(),
                status: 'completed'
            };
            
            // Save deposit
            const deposits = DataManager.getData(STORAGE_KEYS.deposits) || [];
            deposits.unshift(deposit);
            DataManager.setData(STORAGE_KEYS.deposits, deposits);
            
            // Add to balance (auto-approve for demo)
            currentUser.balance += amount;
            DataManager.updateUser(currentUser.phone, { balance: currentUser.balance });
            
            updateUserDataUI();
            closeDepositModal();
            NotificationManager.success('Deposit successful! Balance updated.');
        }

        // Handle withdrawal
        function handleWithdraw() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const upi = document.getElementById('withdrawUpi').value.trim();
            
            if (!amount || amount < 100) {
                NotificationManager.error('Minimum withdrawal amount is ₹100');
                return;
            }
            
            if (amount > currentUser.balance) {
                NotificationManager.error('Insufficient balance');
                return;
            }
            
            if (!upi) {
                NotificationManager.error('Please enter UPI ID');
                return;
            }
            
            // Create withdrawal request
            const withdrawal = {
                id: Date.now().toString(),
                phone: currentUser.phone,
                name: currentUser.name,
                amount: amount,
                upi: upi,
                date: new Date().toISOString(),
                status: 'pending'
            };
            
            // Save withdrawal
            const withdrawals = DataManager.getData(STORAGE_KEYS.withdrawals) || [];
            withdrawals.unshift(withdrawal);
            DataManager.setData(STORAGE_KEYS.withdrawals, withdrawals);
            
            // Deduct from balance
            currentUser.balance -= amount;
            DataManager.updateUser(currentUser.phone, { balance: currentUser.balance });
            
            updateUserDataUI();
            closeWithdrawModal();
            NotificationManager.success('Withdrawal request submitted! Processing within 24 hours.');
        }

        // Load transaction history
        function loadTransactionHistory() {
            const deposits = DataManager.getData(STORAGE_KEYS.deposits) || [];
            const withdrawals = DataManager.getData(STORAGE_KEYS.withdrawals) || [];
            
            const userDeposits = deposits.filter(d => d.phone === currentUser.phone);
            const userWithdrawals = withdrawals.filter(w => w.phone === currentUser.phone);
            
            const transactions = [
                ...userDeposits.map(d => ({...d, type: 'deposit'})),
                ...userWithdrawals.map(w => ({...w, type: 'withdrawal'}))
            ].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const container = document.getElementById('transactionHistory');
            
            if (transactions.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 py-8">
                        <i class="fas fa-receipt text-4xl mb-3"></i>
                        <p>No transactions yet</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            transactions.forEach(transaction => {
                const transactionDiv = document.createElement('div');
                transactionDiv.className = 'bg-gray-700 rounded-lg p-4 flex justify-between items-center';
                
                const statusColor = transaction.status === 'completed' ? 'text-green-400' : 
                                   transaction.status === 'pending' ? 'text-yellow-400' : 'text-red-400';
                
                transactionDiv.innerHTML = `
                    <div>
                        <div class="font-semibold">${transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1)}</div>
                        <div class="text-sm text-gray-400">${new Date(transaction.date).toLocaleDateString()}</div>
                        <div class="text-sm ${statusColor}">${transaction.status.toUpperCase()}</div>
                    </div>
                    <div class="text-right">
                        <div class="font-semibold ${transaction.type === 'deposit' ? 'text-green-400' : 'text-red-400'}">
                            ${transaction.type === 'deposit' ? '+' : '-'}₹${transaction.amount}
                        </div>
                        ${transaction.utr ? `<div class="text-xs text-gray-400">UTR: ${transaction.utr}</div>` : ''}
                        ${transaction.upi ? `<div class="text-xs text-gray-400">UPI: ${transaction.upi}</div>` : ''}
                    </div>
                `;
                
                container.appendChild(transactionDiv);
            });
        }

        // Load betting history
        function loadBettingHistory() {
            const bets = DataManager.getData(STORAGE_KEYS.bets) || [];
            const userBets = bets.filter(bet => bet.phone === currentUser.phone)
                                 .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const container = document.getElementById('bettingHistory');
            
            if (userBets.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 py-8">
                        <i class="fas fa-chart-line text-4xl mb-3"></i>
                        <p>No betting history found</p>
                    </div>
                `;
                return;
            }
            
            displayBettingHistory(userBets);
        }

        // Display betting history
        function displayBettingHistory(bets) {
            const container = document.getElementById('bettingHistory');
            container.innerHTML = '';
            
            bets.forEach(bet => {
                const betDiv = document.createElement('div');
                betDiv.className = 'bg-gray-800 rounded-lg p-4';
                
                const statusColor = bet.status === 'pending' ? 'text-yellow-400' : 
                                   bet.status === 'win' ? 'text-green-400' : 'text-red-400';
                
                betDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <div class="text-lg font-semibold">Period ${bet.period}</div>
                        <div class="text-sm ${statusColor} font-semibold">${bet.status.toUpperCase()}</div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="text-sm text-gray-400">Bet Type</div>
                            <div class="font-semibold">${bet.type.toUpperCase()}: ${bet.value}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">Amount</div>
                            <div class="font-semibold">₹${bet.amount}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">Date</div>
                            <div class="font-semibold">${new Date(bet.date).toLocaleDateString()}</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400">${bet.status === 'win' ? 'Win Amount' : 'Result'}</div>
                            <div class="font-semibold ${bet.status === 'win' ? 'text-green-400' : ''}">
                                ${bet.status === 'win' ? '₹' + bet.winAmount : bet.result !== undefined ? bet.result : '-'}
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(betDiv);
            });
        }

        // Redeem gift code
        function redeemGiftCode() {
            const code = document.getElementById('giftCodeInput').value.trim().toUpperCase();
            
            if (!code) {
                NotificationManager.error('Please enter a gift code');
                return;
            }
            
            const giftCodes = DataManager.getData(STORAGE_KEYS.giftCodes) || {};
            const giftCode = giftCodes[code];
            
            if (!giftCode) {
                NotificationManager.error('Invalid gift code');
                return;
            }
            
            if (giftCode.used) {
                NotificationManager.error('Gift code already used');
                return;
            }
            
            if (new Date() > new Date(giftCode.expiry)) {
                NotificationManager.error('Gift code has expired');
                return;
            }
            
            // Mark as used
            giftCode.used = true;
            giftCode.usedBy = currentUser.phone;
            giftCode.usedDate = new Date().toISOString();
            DataManager.setData(STORAGE_KEYS.giftCodes, giftCodes);
            
            // Add to balance
            currentUser.balance += giftCode.amount;
            DataManager.updateUser(currentUser.phone, { balance: currentUser.balance });
            
            updateUserDataUI();
            document.getElementById('giftCodeInput').value = '';
            loadGiftCodeHistory();
            NotificationManager.success(`Gift code redeemed! ₹${giftCode.amount} added to your balance`);
        }

        // Load gift code history
        function loadGiftCodeHistory() {
            const giftCodes = DataManager.getData(STORAGE_KEYS.giftCodes) || {};
            const userCodes = Object.entries(giftCodes)
                .filter(([code, data]) => data.usedBy === currentUser.phone)
                .map(([code, data]) => ({code, ...data}))
                .sort((a, b) => new Date(b.usedDate) - new Date(a.usedDate));
            
            const container = document.getElementById('giftCodeHistory');
            
            if (userCodes.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 py-8">
                        <i class="fas fa-gift text-4xl mb-3"></i>
                        <p>No gift codes redeemed yet</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            userCodes.forEach(giftCode => {
                const codeDiv = document.createElement('div');
                codeDiv.className = 'bg-gray-700 rounded-lg p-4 flex justify-between items-center';
                
                codeDiv.innerHTML = `
                    <div>
                        <div class="font-mono font-semibold">${giftCode.code}</div>
                        <div class="text-sm text-gray-400">${new Date(giftCode.usedDate).toLocaleDateString()}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-green-400 font-semibold">+₹${giftCode.amount}</div>
                    </div>
                `;
                
                container.appendChild(codeDiv);
            });
        }

        // Handle logout
        function handleLogout() {
            // Clear user session
            if (currentUser) {
                const sessions = DataManager.getData(STORAGE_KEYS.userSessions) || {};
                if (sessions[currentUser.phone]) {
                    sessions[currentUser.phone].isActive = false;
                    DataManager.setData(STORAGE_KEYS.userSessions, sessions);
                }
            }
            
            RealtimeManager.stopHeartbeat();
            
            currentUser = null;
            DataManager.setData(STORAGE_KEYS.currentUser, null);
            
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('backButton').classList.add('hidden');
            document.getElementById('realtimeStatus').textContent = 'Offline';
            
            // Reset forms
            document.getElementById('loginPhone').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('signupName').value = '';
            document.getElementById('signupPhone').value = '';
            document.getElementById('signupPassword').value = '';
            
            NotificationManager.success('Logged out successfully');
        }

        // Initialize the application
        window.addEventListener('load', init);

        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Page is hidden
                if (currentUser) {
                    const sessions = DataManager.getData(STORAGE_KEYS.userSessions) || {};
                    if (sessions[currentUser.phone]) {
                        sessions[currentUser.phone].lastSeen = Date.now();
                        DataManager.setData(STORAGE_KEYS.userSessions, sessions);
                    }
                }
            } else {
                // Page is visible
                if (currentUser) {
                    DataManager.updateOnlineStatus();
                    RealtimeManager.updateOnlineCount();
                }
            }
        });

        // Handle page unload
        window.addEventListener('beforeunload', () => {
            if (currentUser) {
                const sessions = DataManager.getData(STORAGE_KEYS.userSessions) || {};
                if (sessions[currentUser.phone]) {
                    sessions[currentUser.phone].isActive = false;
                    DataManager.setData(STORAGE_KEYS.userSessions, sessions);
                }
            }
        });
    </script>
</body>
</html>
